<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<div class="nav-superior shadow rounded my-auto">
    <ol class="nav-superior__breadcrumb m-0 breadcrumb">        
        <li class="breadcrumb-item"><a href="/dashboard">TABLERO</a></li>
        <li class="breadcrumb-item active" aria-current="page">Hist√≥ricos de dispositivos</li>
    </ol>
</div>
<div class="contenido-principal px-3">
   
    <form class="p-4 bg-light rounded">
        <div class="row">
            <div class="col">
                <label for="exampleFormControlSelect1">Seleccionar Dispositivo</label>
                <select class="form-control" id="exampleFormControlSelect1">
                    <option selected>Temperatura</option>
                   
                </select>
            </div>
            <div class="col">
                <label for="datetimepicker1">Desde: </label>
                <div class="input-group date" id="datetimepicker1" data-target-input="nearest">
                    <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker1" id="desde"/>
                    <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                    </div>
                </div>
            </div>
            <div class="col">
                <label for="datetimepicker2">Hasta: </label>
                <div class="input-group date" id="datetimepicker2" data-target-input="nearest">
                    <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker2" id="hasta"/>
                    <div class="input-group-append" data-target="#datetimepicker2" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-2">
                <label for="consulta_historico" style="visibility:hidden">Label for button</label>
                <button type="button" class="btn btn-primary d-block" id="consulta_historico" onclick="query_data()">Enviar consulta</button>
            </div>
            
        </div>
    </form>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">


    let dateCurr = new Date();
            $(function () {
                $('#datetimepicker1').datetimepicker({
                    locale: 'es-cl',
                    format: 'YYYY-MM-DD HH:mm:ss',
                    maxDate: dateCurr,
                });
            });
            $(function () {
                $('#datetimepicker2').datetimepicker({
                    format: 'YYYY-MM-DD HH:mm:ss',
                    maxDate: dateCurr,
                });
            });


            
      
      
      function query_data(){
            let fecha_desde = document.getElementById('desde').value;
            let fecha_hasta = document.getElementById('hasta').value;
            //let fecha_desde = moment(fecha_desde2, 'YYYY-MM-DD hh:mm:ss');
            //let fecha_hasta = moment(fecha_hasta2, 'YYYY-MM-DD hh:mm:ss');

            //let fecha_desde = document.getElementById('desde').value;
            //let fecha_hasta = document.getElementById('hasta').value;
            //let fecha_desde1 = "2021-04-01 15:00:00";
            //let fecha_hasta1 = "2021-04-01 16:30:00";

            let ejemplo2 = [];
            console.log(fecha_desde, fecha_hasta);
            
            axios(
                { 
                    method: 'POST', 
                    url: 'http://localhost:3000/api/historicos', 
                    headers: {
                        Authorization: "Bearer Token"
                    }, 
                    data: { 
                        fecha_desde,
                        fecha_hasta
                    }
                }
            ).then((res) => {
                
                console.log(res.data.data[0].temp);
                for(let i = 0; i < res.data.data.length; i ++){
                    ejemplo2.push([new Date(res.data.data[i].time), res.data.data[i].temp]);
                }
                console.log(ejemplo2);
                google.charts.load('current', {'packages':['corechart']});
                google.charts.setOnLoadCallback(drawChart);
                function drawChart() {
                    var data = new google.visualization.DataTable();
                    data.addColumn('datetime', 'X');
                    data.addColumn('number', 'Temperatura');
                    var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));
        
      

                    var options = {
                    title: '',
                    hAxis: {title: 'tiempo',  titleTextStyle: {color: '#333'}},
                    vAxis: {
                        minValue: 0,
                        scaleType: 'log'
                    }
                    };

                    data.addRows(ejemplo2);
                    chart.draw(data, options);

                    }
        

            }).catch((err) => {
                
                console.log(err);
            });
        };



      
        
    </script>
    <div id="chart_div" class="mt-3 bg-light rounded" style="width: 100%; height: 400px;"></div>
</div>
<script type="text/javascript">
            
            


            
</script>